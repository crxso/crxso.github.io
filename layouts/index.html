{{ define "main" }}
    
    {{/* CUSTOM CONTENT INJECTION: This renders content/_index.md */}}
    {{/* The style here helps reduce top spacing */}}
    {{ with .Content }}
    <section class="article-list custom-homepage-content" style="padding-top: 0; padding-bottom: 0;">
        {{ . }}
    </section>
    {{ end }}
    
    {{/* The date/time header is included via the site's <head> partial 
        and does NOT need to be called here. */}}
    
    {{- $subsections := .Sections -}}
    {{- $pages := .Pages | complement $subsections -}}
    
    {{- if eq (len $pages) 0 -}}
        {{- $pages = $subsections -}}
        {{- $subsections = slice -}}
    {{- end -}}

    {{- with $subsections -}}
        <aside>
            <h2 class="section-title">{{ T "list.subsection" (len $subsections) }}</h2>
            <div class="subsection-list">
                <div class="article-list--tile">
                    {{ range . }}
                        {{ partial "article-list/tile" (dict "context" . "size" "250x150" "Type" "section") }}
                    {{ end }}
                </div>
            </div>
        </aside>
    {{- end -}}
    
    {{/* List the blog posts using the full card style (article-list/default) */}}
    {{ $paginator := .Paginate $pages }}
    
    <section class="article-list" style="margin-top: 0px;">
        {{ range $paginator.Pages }}
            {{ partial "article-list/default" . }}
        {{ end }}
    </section>

    {{- partial "pagination.html" . -}}

    {{/* ------------------------------------------------------------- */}}
    {{/* GITHUB GRAPH INJECTION */}}
    {{/* ------------------------------------------------------------- */}}
    
    <div id="github-graph-scroll-wrapper" style="
        overflow-x: auto; 
        -webkit-overflow-scrolling: touch;
        margin: 40px auto 40px; 
        padding-top: 20px; 
        max-width: 100%;
        border-top: 1px solid var(--card-separator-color, #30363D); /* Use a dynamic color variable for the border */
        padding-left: 10px;
        padding-right: 10px;
    ">
        <div style="text-align: center; width: max-content; margin: 0 auto;">
            <a href="https://github.com/crxso" target="_blank" title="View my GitHub Profile">
              <img id="github-contributions-graph" 
                   src=""
                   alt="crxso's GitHub Contributions" 
                   style="
                        max-width: 100%; 
                        height: auto; 
                        border-radius: 0px; 
                        box-shadow: 0 4px 12px rgba(254, 0, 0, 0.1);
                        margin-bottom: 20px; 
                        transform: scale(1.02);
                        transform-origin: center;
                   ">
            </a>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const wrapper = document.getElementById('github-graph-scroll-wrapper');
            const graphImg = document.getElementById('github-contributions-graph');
            const root = document.querySelector(':root');

            // 1. Theme-Switching Logic
            const darkSrc = 'https://ghchart.rshah.org/0c8b00/crxso';
            const lightSrc = 'https://ghchart.rshah.org/ce0000/crxso';

            function updateGraphSrc() {
                // Check the data-scheme attribute on the root element
                const isDark = root.getAttribute('data-scheme') === 'dark';
                graphImg.src = isDark ? darkSrc : lightSrc;
            }

            // Initial load
            if (graphImg && root) {
                updateGraphSrc();
            }

            // Observe changes to the data-scheme attribute to handle mode switching
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'data-scheme') {
                        updateGraphSrc();
                    }
                });
            });

            if (root) {
                observer.observe(root, { attributes: true });
            }

            // 2. Scrolling Logic (retained)
            if (wrapper) {
                // Scrolls to the far right, which is standard for GitHub graphs
                setTimeout(() => {
                    // Use scrollLeft to scroll the content inside the wrapper
                    wrapper.scrollLeft = wrapper.scrollWidth;
                }, 100); 
            }
        });
    </script>
    
    {{ partialCached "footer/footer" . }}
{{ end }}

{{ define "right-sidebar" }}
    {{ partial "sidebar/right.html" (dict "Context" . "Scope" "homepage") }}
{{ end }}